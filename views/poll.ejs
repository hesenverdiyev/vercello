<!DOCTYPE html>
<html lang="tr">

<head>
	<!-- basic -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- mobile metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<!-- site metas -->
	<title>Anketler.info - <%= poll.pollquestion %></title>
	<meta name="description" content="<%= poll.pollquestion %> - Anket">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://www.anketler.info/">
	<meta property="og:locale" content="tr_TR">
	<meta property="og:site_name" content="Anketler.info">
	<meta property="og:title" content="<%= poll.pollquestion %>">
	<meta property="og:description" content="<%= poll.pollquestion %> - Anket">
	<meta property="og:image" content="https://www.anketler.info/images/og-image.jpg">
	<meta property="fb:app_id" content="595646712480664">
	<meta property="fb:pages" content="113982751531362">
	<!-- bootstrap css -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<!-- style css -->
	<link rel="stylesheet" href="/css/style.css">
	<!-- Responsive-->
	<link rel="stylesheet" href="/css/responsive.css">
	<!-- fevicon -->
	<link rel="icon" href="/images/favicon.png" type="image/gif" />
	<!-- Tweaks for older IEs-->
	<link rel="stylesheet" href="/css/owl.carousel.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- <link rel="stylesheet" href="https://rawgit.com/LeshikJanz/libraries/master/Bootstrap/baguetteBox.min.css"> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CQRNLE9FMX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CQRNLE9FMX');
</script>
	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
	<style>

		.card-title,
		.card-text,
		.btn {
			text-align: center;
		}

		.ml-3,
		.mx-3 {
			margin-left: auto !important;
			margin-right: auto !important;
		}
      .my-list > li {
   
    list-style: decimal;
}
.card-img-top{
border-bottom: 1px solid rgba(0,0,0,.125);
}

#resultsplace {
  display: none;
}
.initial-circle {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #FE669E;
      color: #FFCBDE;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      margin-right: 10px;
      line-height: 30px;
    }
    .comment-container {
      display: flex;
      align-items: center;
    }
    .comment-text {
      margin-bottom: 0;
    }
    .delete-button {
      margin-left: auto;
    }
    .comments-container > .comment-container:nth-child(n+11) {
  display: none;
}
	</style>
</head>
<!-- body -->

<body class="main-layout inner_page">
	<!-- loader  -->
	<div class="loader_bg">
		<div class="loader"><img src="/images/loading.gif" alt="#" /></div>
	</div>
	<!-- end loader -->

	<!-- header -->
	<%- include("partials/_menu") %>
		<!-- end header inner -->
		<!-- about -->
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-2 bg-light">
					<div class="sidebar-left" id="sidebar-left">
					  <a href="https://www.youtube.com/watch?v=hw1BBtUkdzA">
					  <img src="/images/vertical-banner.gif" alt="Vertical Banner">
            </a>
					</div>
				  </div>
				<div class="col-md-8" >
          <div class="col-md-12" style="text-align: center;">
            <a href="https://www.youtube.com/watch?v=hw1BBtUkdzA" >
            <img src="/images/banner1.gif" alt="Top Banner">
          </a>
         </div>
          <h1 align="center" style="margin-top: 15px;"><b><%= poll.pollquestion %> - <u>Anket</u></b></h1>
					<div class="row">


             <% poll.options.forEach(function(option) { %>
							<div class="card-deck mt-5 ml-3 mr-3">
								<div class="card">
                  <% if (option.picture) { %>
									<img class="card-img-top" src="<%= option.picture %>" alt="<%= option.title %>"
										style=" height: 170px; width: 155px; margin-left: auto; margin-right: auto;">
                      <% } %>
									<h6 class="card-title" style="margin-top:10px;">
                    <input type="radio" class="radio-option" name="optiontitle" value="<%= option.title %>" <%= option.title === poll.options[1].title ? 'checked' : '' %>>
                    <b><%= option.title %></b></h6>
								</div>
						</div>
             <% }); %>
					</div>

          <% if (user) { %>
            <div class="row justify-content-center" style="margin-top: 20px;">
              <div class="col-sm-1.5 text-center">
                <button type="submit" class="btn btn-success" id="submitButton">oy kullan</button>
              </div>
              <div class="col-sm-1 text-center">
                <span class="or-text">veya</span>
              </div>
              <div class="col-sm-1.5 text-center">
                <button type="button" class="btn btn-danger" id="showresults">sonuçları gör</button>
              </div>
            </div>
            <% } else { %>
              <div class="row justify-content-center" style="margin-top: 20px;">
                <div class="col-sm-1.5 text-center">
                  <a href="/register" class="btn btn-success">oy kullan</a>
                </div>
                <div class="col-sm-1 text-center">
                  <span class="or-text">veya</span>
                </div>
                <div class="col-sm-1.5 text-center">
                  <a href="/register" class="btn btn-danger">sonuçları gör</a>
                </div>
              </div>
              <% } %>
        

          <div class="col-md-12" id="resultsplace" style="margin-top: 40px;">
            <h2 align="center"><u>Sonuçlar</u> : <%= pollquestion %></h2>
            <% let totalVotes = 0; %>
            <% results.forEach(function(result) { %>
              <% totalVotes += result.votes; %>
            <% }); %>
            <ol class="my-list">
              <% results.forEach(result => { %>
                <% let votePercentage = (result.votes * 100) / totalVotes; %>
                <li>
                  <h4><%= result.title %></h4>
                  <div class="chart" style="width: <%= (votePercentage + 7).toFixed(1) %>%;">
                    <%= votePercentage.toFixed(1) %>%</div>
                </li>
              <% }); %>
            </ol>
            <p>Toplam oy sayısı : <%= totalVotes %></p>
           </div>

<hr style="margin-top: 80px;">

           <div class="container my-5" style="margin-top: 0px !important;">
            <h2 style="margin-bottom: 15px;">Yorumlar</h2>
            <form>
              <div class="col-md-5">
              <div class="form-group">
                <label for="name">İsim:</label>
                
                <input type="text" class="form-control" id="commentername" placeholder="İsminiz" required>
              </div>
              <div class="form-group">
                <label for="comment">Yorum:</label>
                <textarea class="form-control" id="commenttext" rows="3" placeholder="Yorumunuz" required></textarea>
              </div>
              <% if (user) { %>
              <input id="submitCommentButton" style="width: 80px; height: 45px;" type="submit" value="Yorum yaz" disabled/>
              <% } else { %>
                <a href="/register" class="btn btn-warning">Kayıt ol - Yorum yaz</a>
                <% } %>
            </form>
          </div>
          
        <hr>
        
        <div id="comments" class="my-5">
          <% if (comments.length === 0) { %>
            <p style="text-align: center;">Yorum yok, ilk yorumu sen yap</p>
          <% } else { %>
            <div class="comments-container">
              <% for (let i = 0; i < comments.length; i++) { %>
                <div class="my-3 p-3 bg-light rounded comment-container">
                  <div class="initial-circle" style="margin-top: -15px;"><%= comments[i].commenterName.charAt(0).toUpperCase() %></div>
                  <div class="media-body">
                    <h6 class="mt-0 mb-1"><%= comments[i].commenterName %>
                      <small class="text-muted"><%= new Date(comments[i].commentDate).toLocaleString('tr-TR', { hour12: false, timeZone: 'Europe/Istanbul' }) %></small>
                    </h6>
                    <p class="comment-text"><%= comments[i].commentText %></p>
                  </div>
                  <% if (userId && comments[i].commenterId.toString() === userId.toString() ) { %>
                    <button class="btn btn-danger my-2 delete-button" id="deletecommentbutton" value="<%= comments[i].commenterId %>" data-comment-id="<%= comments[i]._id %>">Yorumu sil</button>
                  <% } %>
                </div> 
              <% } %>
            </div>
            <% if (comments.length > 10) { %>
              <div style="text-align: center;">
                <button id="show-more-btn" class="btn btn-link"><u>Tüm yorumları göster</u></button>
              </div>
            <% } %>
          <% } %>
        </div>

           <div class="col-md-12" style="background-color: #f2f2f2; padding: 10px; text-align: center; margin-top: 80px; margin-left: auto; margin-right: auto;">
            <h2 style="font-size: 24px;"><strong><em style="color: #424242;">Diğer anketler</em></strong></h2>
          </div>
  
          <div class="col-md-12" style="margin-bottom: 50px">
            <div id="news-slider" class="owl-carousel" style="margin-top: 0px;">
          <% for (poll of polls) { %>
              <div class="post-slide">
                <div class="post-img">
                  <img src="<%= poll.options[0].picture %>" alt="<%= poll.options[0].title %>" style="height:122px; width: 122px">
                  <img src="<%= poll.options[1].picture %>" alt="<%= poll.options[1].title %>" style="height:122px; width: 122px">
          <a href="/polls/<%= poll.pollname %>" class="over-layer"><i class="fa fa-link"></i></a>
                </div>
                <div class="post-content">
                  <h3 class="post-title" style="text-align: center;">
                    <a href="/polls/<%= poll.pollname %>"><%= poll.pollquestion %></a>
                  </h3>
                </div>
              </div>
        <% } %>
            </div>
          </div>

           <div class="col-md-12" style="text-align: center; margin-top: 100px;">
            <a href="https://www.youtube.com/watch?v=hw1BBtUkdzA" >
            <img src="/images/banner1.gif" alt="Top Banner">
          </a>
           </div> 

				</div>
      </div>
				<div class="col-md-2 bg-light">
					<div class="sidebar-right">
					  <!-- <a href="https://www.youtube.com/watch?v=hw1BBtUkdzA">
					  <img src="/images/vertical-banner.gif" alt="Vertical Banner">
					</a> -->
					</div>
				  </div>
		</div>
		</div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          const cards = document.querySelectorAll('.card');
          cards.forEach((card, index) => {
            if (index === 1) {
              card.style.borderColor = '#1a8cff'
            }
          });

        });

     document.getElementById('showresults').addEventListener('click', function(){
      document.getElementById('resultsplace').style.display = 'block'
     });
    </script>
    <script>

      // Select all cards with the class "card"
      const cards = document.querySelectorAll('.card');
    
      // Adding a click event listener to each card
      cards.forEach(card => {
        card.addEventListener('click', () => {
          // Get the radio button element within the card


          cards.forEach(card => {
         card.style.borderColor = '#dee2e6'
          });


          const radio = card.querySelector('input[type="radio"]');
          
           card.style.borderColor = '#1a8cff';
          // If the radio button is not already selected, select it
          if (!radio.checked) {
            radio.checked = true;
          
          }
        });
      });
      
    </script>
    <script>
    const submitButton = document.getElementById('submitButton')
    submitButton.addEventListener('click', async (event) => {
      event.preventDefault()
      var optiontitle;
      var ele = document.getElementsByName('optiontitle');
      for(i = 0; i < ele.length; i++) {
            if(ele[i].checked)
            var optiontitle = ele[i].value;
        }

      try {
  const response = await fetch('/polls/<%= pollname %>/vote', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ optiontitle })
  });
  const data = await response.json();

  if (response.ok) {
    Swal.fire({
      title: data.message,
      icon: 'success'
    });
    document.getElementById('resultsplace').style.display = 'block';
    // Do something with the updated poll object, e.g. display a message
  } else {
    Swal.fire({
      title: data.message,
      icon: 'error'
    });
    // Handle error
  }
} catch (error) {
  console.error(error);
  alert('An error occurred while voting in the poll.');
}
    })
  </script>
  <script>
const commentForm = document.querySelector('form');
const commenterName = document.getElementById('commentername').value;
const commentText = document.getElementById('commenttext').value;
                
commentForm.addEventListener('submit', async (event) => {
  
  
  const commenterName = document.getElementById('commentername').value;
  const commentText = document.getElementById('commenttext').value;
  
  try {
    const response = await fetch('/polls/<%= pollname %>/comment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ commenterName, commentText }),
    });
    
  } catch (error) {
    console.error(error);
    alert('Hatalı');
  }
});

  </script>
  <script>
    const deleteButtons = document.querySelectorAll('.delete-button');

deleteButtons.forEach((button) => {
  button.addEventListener('click', async (event) => {
    const commentId = event.target.dataset.commentId;
    const response = await fetch(`/comments/${commentId}`, { method: 'DELETE' });
    if (response.ok) {
      event.target.closest('.comment-container').remove();
    }
  });
});
  </script>
  <script>
    const commenterNameInput = document.getElementById('commentername');
const commentTextInput = document.getElementById('commenttext');
const submitCommentButton = document.getElementById('submitCommentButton');

commenterNameInput.addEventListener('input', toggleSubmitButton);
commentTextInput.addEventListener('input', toggleSubmitButton);

function toggleSubmitButton() {
  if (commenterNameInput.value.trim() !== '' && commentTextInput.value.trim() !== '') {
    submitCommentButton.disabled = false;
  } else {
    submitCommentButton.disabled = true;
  }
}
  </script>
  <script>
const showMoreBtn = document.querySelector('#show-more-btn');
if (showMoreBtn) {
  showMoreBtn.addEventListener('click', () => {
    document.querySelectorAll('.comments-container > .comment-container').forEach(comment => {
      comment.style.display = 'flex';
    });
    showMoreBtn.style.display = 'none';
  });
}

  </script>

		<!-- end about -->
		<!-- end footer -->
		<%- include("partials/_footer") %>
